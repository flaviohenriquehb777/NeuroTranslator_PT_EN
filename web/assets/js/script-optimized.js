(function(){"use strict";class v{constructor(){this.speech={recognition:null,active:!1,supported:!1},this.translation={history:[],autoTranslate:!0},this.elements={},this.lastTranslation=null,this.init()}init(){this.initElements(),this.initEventListeners(),this.checkMobileCompatibility(),this.checkBrowserSupport()}initElements(){this.elements.sourceLanguage=document.getElementById("sourceLanguage"),this.elements.targetLanguage=document.getElementById("targetLanguage"),this.elements.sourceText=document.getElementById("sourceText"),this.elements.targetText=document.getElementById("targetText"),this.elements.translateBtn=document.getElementById("translateBtn"),this.elements.swapLanguages=document.getElementById("swapLanguages"),this.elements.toggleSpeech=document.getElementById("toggleSpeech"),this.elements.speechStatus=document.getElementById("speechStatus"),this.elements.clearText=document.getElementById("clearText"),this.elements.copyTranslation=document.getElementById("copyTranslation"),this.elements.speakTranslation=document.getElementById("speakTranslation"),this.elements.autoTranslate=document.getElementById("autoTranslate"),this.elements.historyContainer=document.getElementById("historyContainer"),this.elements.clearHistory=document.getElementById("clearHistory"),this.elements.translationStatus=document.getElementById("translationStatus"),this.elements.processingTime=document.getElementById("translationTime")}initEventListeners(){this.elements.translateBtn.addEventListener("click",()=>this.translateText()),this.elements.swapLanguages.addEventListener("click",()=>this.swapLanguages()),this.elements.sourceText.addEventListener("input",()=>this.onTextInput()),this.elements.toggleSpeech.addEventListener("click",()=>this.toggleSpeech()),this.elements.clearText.addEventListener("click",()=>this.clearText()),this.elements.copyTranslation.addEventListener("click",()=>this.copyTranslation()),this.elements.speakTranslation.addEventListener("click",()=>this.speakOutTranslation()),this.elements.clearHistory.addEventListener("click",()=>this.clearHistory()),document.addEventListener("keydown",t=>this.handleKeyboard(t))}isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}checkMobileCompatibility(){return!0}checkBrowserSupport(){this.speech.supported="webkitSpeechRecognition"in window||"SpeechRecognition"in window}initSpeechRecognition(){const t=window,e=t.SpeechRecognition||t.webkitSpeechRecognition;if(!e){this.speech.supported=!1;return}const n=new e,s=this.elements.sourceLanguage.value;n.lang=s==="pt"?"pt-BR":s==="en"?"en-US":s,n.continuous=!1,n.interimResults=!1,n.onresult=a=>{const p=a.results[0][0].transcript;this.elements.sourceText.value=p,this.onTextInput()},n.onerror=()=>{this.stopSpeech()},this.speech.recognition=n}toggleSpeech(){this.speech.recognition||this.initSpeechRecognition(),this.speech.recognition&&(this.speech.active?this.stopSpeech():this.startSpeech())}startSpeech(){var t;try{this.speech.active=!0,this.elements.speechStatus.textContent="üé§ Reconhecimento: Ativado",this.elements.toggleSpeech.classList.add("active"),(t=this.speech.recognition)==null||t.start()}catch{this.speech.active=!1}}stopSpeech(){var t;try{(t=this.speech.recognition)==null||t.stop()}finally{this.speech.active=!1,this.elements.speechStatus.textContent="üé§ Reconhecimento: Desativado",this.elements.toggleSpeech.classList.remove("active")}}async translateText(){var p,d,l,y,m;const t=this.elements.sourceText.value.trim(),e=this.elements.targetText,n=this.elements.translationStatus,s=this.elements.sourceLanguage.value,a=this.elements.targetLanguage.value;if(!t){n.textContent="Nada para traduzir",e.value="";return}n.textContent="Traduzindo...",(p=this.elements.translateBtn)==null||p.setAttribute("disabled","true"),(d=this.elements.translateBtn)==null||d.setAttribute("aria-busy","true");const u=performance.now();try{const r=`https://api.mymemory.translated.net/get?q=${encodeURIComponent(t)}&langpair=${s}|${a}`;let i="";const h=await fetch(r,{headers:{Accept:"application/json"},cache:"no-store"}).catch(o=>(console.warn("MyMemory erro",o),null));if(h&&h.ok&&(i=((l=(await h.json()).responseData)==null?void 0:l.translatedText)||""),!i){const f=[location.hostname==="localhost"||location.hostname==="127.0.0.1"?"http://localhost:3000/translate":null,"https://translate.astian.org/translate","https://libretranslate.de/translate","https://libretranslate.com/translate","https://translate.argosopentech.com/translate"].filter(Boolean);for(const g of f){const c=await fetch(g,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},referrerPolicy:"no-referrer",body:JSON.stringify({q:t,source:s===a?"auto":s,target:a,format:"text"})}).catch(T=>(console.warn("Endpoint erro",g,T),null));if(c&&c.ok){if(i=(await c.json()).translatedText||"",i){console.log("Traduzido por",g);break}}else console.warn("Falha endpoint",g,c==null?void 0:c.status)}}i=this.preserveCasing(t,i||t),e.value=i,n.textContent="Pronto para traduzir"}catch{e.value=t,n.textContent="Falha na tradu√ß√£o"}finally{const r=Math.round(performance.now()-u);this.elements.processingTime.textContent=`${r} ms`,(y=this.elements.translateBtn)==null||y.removeAttribute("disabled"),(m=this.elements.translateBtn)==null||m.setAttribute("aria-busy","false")}}preserveCasing(t,e){if(!/[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]/.test(t))return e;const s=t.replace(/[^A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]/g,""),a=s.length>0&&s===s.toLowerCase(),u=s.length>0&&s===s.toUpperCase();if(a)return e.toLowerCase();if(u)return e.toUpperCase();const p=this.tokenize(t),d=this.tokenize(e),l=this.wordUpperPattern(p);if((l.length?l.filter(Boolean).length/l.length:0)>=.6)return this.applyWordPattern(d,l);const m=t.match(/[^.!?]+[.!?]*/g)||[t],r=e.match(/[^.!?]+[.!?]*/g)||[e],i=Math.min(m.length,r.length),h=[];for(let o=0;o<i;o++){const f=m[o],g=r[o],c=this.isFirstAlphaUpper(f);h.push(this.adjustFirstAlpha(g,c))}for(let o=i;o<r.length;o++)h.push(r[o]);return h.join("")}isFirstAlphaUpper(t){for(const e of Array.from(t))if(/[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]/.test(e))return e===e.toUpperCase();return!1}adjustFirstAlpha(t,e){const n=Array.from(t);for(let s=0;s<n.length;s++){const a=n[s];if(/[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]/.test(a)){n[s]=e?a.toUpperCase():a.toLowerCase();break}}return n.join("")}tokenize(t){return(t.match(/[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]+|[^A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]+/g)||[t]).map(n=>({t:n,w:/[A-Za-z√Ä-√ñ√ò-√∂√∏-√ø]/.test(n)}))}wordUpperPattern(t){const e=[];for(const n of t)n.w&&e.push(this.isFirstAlphaUpper(n.t));return e}applyWordPattern(t,e){const n=[];let s=0;for(const a of t){if(!a.w){n.push(a.t);continue}const u=s<e.length?e[s]:!1;s++,n.push(this.adjustFirstAlpha(a.t,u))}return n.join("")}swapLanguages(){const t=this.elements.sourceLanguage,e=this.elements.targetLanguage;[t.value,e.value]=[e.value,t.value];const n=this.elements.sourceText,s=this.elements.targetText;[n.value,s.value]=[s.value,n.value],this.onTextInput()}clearText(){this.elements.sourceText.value="",this.onTextInput()}async copyTranslation(){const t=this.elements.targetText.value;try{await navigator.clipboard.writeText(t)}catch{}}speakOutTranslation(){const t=this.elements.targetText.value.trim();if(!t)return;const e=new SpeechSynthesisUtterance(t),n=this.elements.targetLanguage.value;e.lang=n==="pt"?"pt-BR":n==="en"?"en-US":n,speechSynthesis.cancel(),speechSynthesis.speak(e)}onTextInput(){var s;const t=this.elements.sourceText.value,e=document.getElementById("charCount");e&&(e.textContent=`${t.length} caracteres`),((s=this.elements.autoTranslate)==null?void 0:s.checked)&&this.translateText()}updateHistoryDisplay(){}clearHistory(){}handleKeyboard(t){}}document.addEventListener("DOMContentLoaded",()=>{window.neuroTranslator=new v,typeof navigator<"u"&&"serviceWorker"in navigator&&(location.hostname==="localhost"||location.hostname==="127.0.0.1"?navigator.serviceWorker.getRegistrations().then(t=>{t.forEach(e=>e.unregister())}):navigator.serviceWorker.register("sw.js").catch(()=>{}))})})();
